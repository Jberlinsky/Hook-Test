




<!DOCTYPE html>
<html class="   ">
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    
    <title>geekq/workflow Â· GitHub</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub" />
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-114.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-144.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144.png" />
    <meta property="fb:app_id" content="1401488693436528"/>

      <meta content="@github" name="twitter:site" /><meta content="summary" name="twitter:card" /><meta content="geekq/workflow" name="twitter:title" /><meta content="workflow - Like acts as state machine (aasm), but _way_ better (it&amp;#39;s in Ruby too!)" name="twitter:description" /><meta content="https://avatars2.githubusercontent.com/u/25747?s=400" name="twitter:image:src" />
<meta content="GitHub" property="og:site_name" /><meta content="object" property="og:type" /><meta content="https://avatars2.githubusercontent.com/u/25747?s=400" property="og:image" /><meta content="geekq/workflow" property="og:title" /><meta content="https://github.com/geekq/workflow" property="og:url" /><meta content="workflow - Like acts as state machine (aasm), but _way_ better (it&#39;s in Ruby too!)" property="og:description" />

    <link rel="assets" href="https://github.global.ssl.fastly.net/">
    <link rel="conduit-xhr" href="https://ghconduit.com:25035/">
    <link rel="xhr-socket" href="/_sockets" />

    <meta name="msapplication-TileImage" content="/windows-tile.png" />
    <meta name="msapplication-TileColor" content="#ffffff" />
    <meta name="selected-link" value="repo_source" data-pjax-transient />
    <meta content="collector.githubapp.com" name="octolytics-host" /><meta content="collector-cdn.github.com" name="octolytics-script-host" /><meta content="github" name="octolytics-app-id" /><meta content="2302E7DE:4A35:3328A2C:535A8980" name="octolytics-dimension-request_id" />
    

    
    
    <link rel="icon" type="image/x-icon" href="https://github.global.ssl.fastly.net/favicon.ico" />

    <meta content="authenticity_token" name="csrf-param" />
<meta content="2eLI/RSenI0jgSIpIn7+tQwgN4cv4yYjvJckfJrj39rnyppDaAWkTaLDQWovfAsIISfcAIRwNs+D6U8f9ahHDQ==" name="csrf-token" />

    <link href="https://github.global.ssl.fastly.net/assets/github-0fccb0d1330ec12e83e33d762026ca69cd2b6862.css" media="all" rel="stylesheet" type="text/css" />
    <link href="https://github.global.ssl.fastly.net/assets/github2-e89308df4085f6abd3233836a0079a1a7e1abd84.css" media="all" rel="stylesheet" type="text/css" />
    


        <script crossorigin="anonymous" src="https://github.global.ssl.fastly.net/assets/frameworks-f8f8d8ee1afb4365ba5e002fdbc3c8e61738713b.js" type="text/javascript"></script>
        <script async="async" crossorigin="anonymous" src="https://github.global.ssl.fastly.net/assets/github-0dce5cbbd453992693347ff7a62aa955cf152870.js" type="text/javascript"></script>
        
        
      <meta http-equiv="x-pjax-version" content="f8ae4599f3ae8a183e55831ae86406ce">

      
  <meta name="description" content="workflow - Like acts as state machine (aasm), but _way_ better (it&#39;s in Ruby too!)" />

  <meta content="25747" name="octolytics-dimension-user_id" /><meta content="geekq" name="octolytics-dimension-user_login" /><meta content="113141" name="octolytics-dimension-repository_id" /><meta content="geekq/workflow" name="octolytics-dimension-repository_nwo" /><meta content="true" name="octolytics-dimension-repository_public" /><meta content="true" name="octolytics-dimension-repository_is_fork" /><meta content="16966" name="octolytics-dimension-repository_parent_id" /><meta content="ryan-allen/workflow" name="octolytics-dimension-repository_parent_nwo" /><meta content="16966" name="octolytics-dimension-repository_network_root_id" /><meta content="ryan-allen/workflow" name="octolytics-dimension-repository_network_root_nwo" />
  <link href="https://github.com/geekq/workflow/commits/master.atom" rel="alternate" title="Recent Commits to workflow:master" type="application/atom+xml" />

  </head>


  <body class="logged_out  env-production  vis-public fork">
    <a href="#start-of-content" tabindex="1" class="accessibility-aid js-skip-to-content">Skip to content</a>
    <div class="wrapper">
      
      
      
      


      
      <div class="header header-logged-out">
  <div class="container clearfix">

    <a class="header-logo-wordmark" href="https://github.com/">
      <span class="mega-octicon octicon-logo-github"></span>
    </a>

    <div class="header-actions">
        <a class="button primary" href="/join">Sign up</a>
      <a class="button signin" href="/login?return_to=%2Fgeekq%2Fworkflow">Sign in</a>
    </div>

    <div class="command-bar js-command-bar  in-repository">

      <ul class="top-nav">
          <li class="explore"><a href="/explore">Explore</a></li>
        <li class="features"><a href="/features">Features</a></li>
          <li class="enterprise"><a href="https://enterprise.github.com/">Enterprise</a></li>
          <li class="blog"><a href="/blog">Blog</a></li>
      </ul>
        <form accept-charset="UTF-8" action="/search" class="command-bar-form" id="top_search_form" method="get">

<div class="commandbar">
  <span class="message"></span>
  <input type="text" data-hotkey="/ s" name="q" id="js-command-bar-field" placeholder="Search or type a command" tabindex="1" autocapitalize="off"
    
    
      data-repo="geekq/workflow"
      data-branch="master"
      data-sha="bee211decf915e8b36b966ce0120bbf4936fce70"
  >
  <div class="display hidden"></div>
</div>

    <input type="hidden" name="nwo" value="geekq/workflow" />

    <div class="select-menu js-menu-container js-select-menu search-context-select-menu">
      <span class="minibutton select-menu-button js-menu-target" role="button" aria-haspopup="true">
        <span class="js-select-button">This repository</span>
      </span>

      <div class="select-menu-modal-holder js-menu-content js-navigation-container" aria-hidden="true">
        <div class="select-menu-modal">

          <div class="select-menu-item js-navigation-item js-this-repository-navigation-item selected">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" class="js-search-this-repository" name="search_target" value="repository" checked="checked" />
            <div class="select-menu-item-text js-select-button-text">This repository</div>
          </div> <!-- /.select-menu-item -->

          <div class="select-menu-item js-navigation-item js-all-repositories-navigation-item">
            <span class="select-menu-item-icon octicon octicon-check"></span>
            <input type="radio" name="search_target" value="global" />
            <div class="select-menu-item-text js-select-button-text">All repositories</div>
          </div> <!-- /.select-menu-item -->

        </div>
      </div>
    </div>

  <span class="help tooltipped tooltipped-s" aria-label="Show command bar help">
    <span class="octicon octicon-question"></span>
  </span>


  <input type="hidden" name="ref" value="cmdform">

</form>
    </div>

  </div>
</div>



      <div id="start-of-content" class="accessibility-aid"></div>
          <div class="site" itemscope itemtype="http://schema.org/WebPage">
    <div id="js-flash-container">
      
    </div>
    <div class="pagehead repohead instapaper_ignore readability-menu">
      <div class="container">
        

<ul class="pagehead-actions">


  <li>
    <a href="/login?return_to=%2Fgeekq%2Fworkflow"
    class="minibutton with-count js-toggler-target star-button tooltipped tooltipped-n"
    aria-label="You must be signed in to star a repository" rel="nofollow">
    <span class="octicon octicon-star"></span>Star
  </a>

    <a class="social-count js-social-count" href="/geekq/workflow/stargazers">
      843
    </a>

  </li>

    <li>
      <a href="/login?return_to=%2Fgeekq%2Fworkflow"
        class="minibutton with-count js-toggler-target fork-button tooltipped tooltipped-n"
        aria-label="You must be signed in to fork a repository" rel="nofollow">
        <span class="octicon octicon-git-branch"></span>Fork
      </a>
      <a href="/geekq/workflow/network" class="social-count">
        122
      </a>
    </li>
</ul>

        <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb" class="entry-title public">
          <span class="repo-label"><span>public</span></span>
          <span class="mega-octicon octicon-repo"></span>
          <span class="author"><a href="/geekq" class="url fn" itemprop="url" rel="author"><span itemprop="title">geekq</span></a></span><!--
       --><span class="path-divider">/</span><!--
       --><strong><a href="/geekq/workflow" class="js-current-repository js-repo-home-link">workflow</a></strong>

          <span class="page-context-loader">
            <img alt="Octocat-spinner-32" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
          </span>

            <span class="fork-flag">
              <span class="text">forked from <a href="/ryan-allen/workflow">ryan-allen/workflow</a></span>
            </span>
        </h1>
      </div><!-- /.container -->
    </div><!-- /.repohead -->

    <div class="container">
      <div class="repository-with-sidebar repo-container new-discussion-timeline js-new-discussion-timeline with-full-navigation ">
        <div class="repository-sidebar clearfix">
            

<div class="sunken-menu vertical-right repo-nav js-repo-nav js-repository-container-pjax js-octicon-loaders">
  <div class="sunken-menu-contents">
    <ul class="sunken-menu-group">
      <li class="tooltipped tooltipped-w" aria-label="Code">
        <a href="/geekq/workflow" aria-label="Code" class="selected js-selected-navigation-item sunken-menu-item" data-gotokey="c" data-pjax="true" data-selected-links="repo_source repo_downloads repo_commits repo_tags repo_branches /geekq/workflow">
          <span class="octicon octicon-code"></span> <span class="full-word">Code</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

        <li class="tooltipped tooltipped-w" aria-label="Issues">
          <a href="/geekq/workflow/issues" aria-label="Issues" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-gotokey="i" data-selected-links="repo_issues /geekq/workflow/issues">
            <span class="octicon octicon-issue-opened"></span> <span class="full-word">Issues</span>
            <span class='counter'>31</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>

      <li class="tooltipped tooltipped-w" aria-label="Pull Requests">
        <a href="/geekq/workflow/pulls" aria-label="Pull Requests" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-gotokey="p" data-selected-links="repo_pulls /geekq/workflow/pulls">
            <span class="octicon octicon-git-pull-request"></span> <span class="full-word">Pull Requests</span>
            <span class='counter'>8</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>


        <li class="tooltipped tooltipped-w" aria-label="Wiki">
          <a href="/geekq/workflow/wiki" aria-label="Wiki" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_wiki /geekq/workflow/wiki">
            <span class="octicon octicon-book"></span> <span class="full-word">Wiki</span>
            <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>        </li>
    </ul>
    <div class="sunken-menu-separator"></div>
    <ul class="sunken-menu-group">

      <li class="tooltipped tooltipped-w" aria-label="Pulse">
        <a href="/geekq/workflow/pulse" aria-label="Pulse" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="pulse /geekq/workflow/pulse">
          <span class="octicon octicon-pulse"></span> <span class="full-word">Pulse</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped tooltipped-w" aria-label="Graphs">
        <a href="/geekq/workflow/graphs" aria-label="Graphs" class="js-selected-navigation-item sunken-menu-item" data-pjax="true" data-selected-links="repo_graphs repo_contributors /geekq/workflow/graphs">
          <span class="octicon octicon-graph"></span> <span class="full-word">Graphs</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>

      <li class="tooltipped tooltipped-w" aria-label="Network">
        <a href="/geekq/workflow/network" aria-label="Network" class="js-selected-navigation-item sunken-menu-item js-disable-pjax" data-selected-links="repo_network /geekq/workflow/network">
          <span class="octicon octicon-git-branch"></span> <span class="full-word">Network</span>
          <img alt="Octocat-spinner-32" class="mini-loader" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
</a>      </li>
    </ul>


  </div>
</div>

              <div class="only-with-full-nav">
                

  

<div class="clone-url open"
  data-protocol-type="http"
  data-url="/users/set_protocol?protocol_selector=http&amp;protocol_type=clone">
  <h3><strong>HTTPS</strong> clone URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="https://github.com/geekq/workflow.git" readonly="readonly">

    <span aria-label="copy to clipboard" class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/geekq/workflow.git" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>

  

<div class="clone-url "
  data-protocol-type="subversion"
  data-url="/users/set_protocol?protocol_selector=subversion&amp;protocol_type=clone">
  <h3><strong>Subversion</strong> checkout URL</h3>
  <div class="clone-url-box">
    <input type="text" class="clone js-url-field"
           value="https://github.com/geekq/workflow" readonly="readonly">

    <span aria-label="copy to clipboard" class="js-zeroclipboard url-box-clippy minibutton zeroclipboard-button" data-clipboard-text="https://github.com/geekq/workflow" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
  </div>
</div>


<p class="clone-options">You can clone with
      <a href="#" class="js-clone-selector" data-protocol="http">HTTPS</a>
      or <a href="#" class="js-clone-selector" data-protocol="subversion">Subversion</a>.
  <span class="help tooltipped tooltipped-n" aria-label="Get help on which URL is right for you.">
    <a href="https://help.github.com/articles/which-remote-url-should-i-use">
    <span class="octicon octicon-question"></span>
    </a>
  </span>
</p>



                <a href="/geekq/workflow/archive/master.zip"
                   class="minibutton sidebar-button"
                   aria-label="Download geekq/workflow as a zip file"
                   title="Download geekq/workflow as a zip file"
                   rel="nofollow">
                  <span class="octicon octicon-cloud-download"></span>
                  Download ZIP
                </a>
              </div>
        </div><!-- /.repository-sidebar -->

        <div id="js-repo-pjax-container" class="repository-content context-loader-container" data-pjax-container>
          

<span id="js-show-full-navigation"></span>

<div class="repository-meta js-details-container ">
    <div class="repository-description js-details-show">
      <p>Like acts as state machine (aasm), but _way_ better (it's in Ruby too!)</p>
    </div>

    <div class="repository-website js-details-show">
      <p><a href="http://www.geekq.net/workflow/" rel="nofollow">http://www.geekq.net/workflow/</a></p>
    </div>


</div>

<div class="capped-box overall-summary ">

  <div class="stats-switcher-viewport js-stats-switcher-viewport">
    <div class="stats-switcher-wrapper">
    <ul class="numbers-summary">
      <li class="commits">
        <a data-pjax href="/geekq/workflow/commits/master">
            <span class="num">
              <span class="octicon octicon-history"></span>
              292
            </span>
            commits
        </a>
      </li>
      <li>
        <a data-pjax href="/geekq/workflow/branches">
          <span class="num">
            <span class="octicon octicon-git-branch"></span>
            2
          </span>
          branches
        </a>
      </li>

      <li>
        <a data-pjax href="/geekq/workflow/releases">
          <span class="num">
            <span class="octicon octicon-tag"></span>
            2
          </span>
          releases
        </a>
      </li>

      <li>
        
          <a href="/geekq/workflow/graphs/contributors" class="js-deferred-content" data-url="/geekq/workflow/contributors_size">
            <span class="num">
              <span class="octicon octicon-organization"></span>
            </span>
            Fetching contributors
          </a>
      </li>
    </ul>

      <div class="repository-lang-stats">
        <ol class="repository-lang-stats-numbers">
          <li>
              <a href="/geekq/workflow/search?l=ruby">
                <span class="color-block language-color" style="background-color:#701516;"></span>
                <span class="lang">Ruby</span>
                <span class="percent">100%</span>
              </a>
          </li>
        </ol>
      </div>
    </div>
  </div>

</div>

  <div class="tooltipped tooltipped-s" aria-label="Show language statistics">
    <a href="#"
     class="repository-lang-stats-graph js-toggle-lang-stats"
     style="background-color:#701516">
  <span class="language-color" style="width:100%; background-color:#701516;" itemprop="keywords">Ruby</span>
    </a>
  </div>



<div class="file-navigation in-mid-page">
    <a href="/geekq/workflow/compare" aria-label="Compare, review, create a pull request" class="minibutton compact primary tooltipped tooltipped-s" aria-label="Compare &amp; review" data-pjax>
      <span class="octicon octicon-git-compare"></span>
    </a>

  

<div class="select-menu js-menu-container js-select-menu" >
  <span class="minibutton select-menu-button js-menu-target" data-hotkey="w"
    data-master-branch="master"
    data-ref="master"
    role="button" aria-label="Switch branches or tags" tabindex="0" aria-haspopup="true">
    <span class="octicon octicon-git-branch"></span>
    <i>branch:</i>
    <span class="js-select-button">master</span>
  </span>

  <div class="select-menu-modal-holder js-menu-content js-navigation-container" data-pjax aria-hidden="true">

    <div class="select-menu-modal">
      <div class="select-menu-header">
        <span class="select-menu-title">Switch branches/tags</span>
        <span class="octicon octicon-remove-close js-menu-close"></span>
      </div> <!-- /.select-menu-header -->

      <div class="select-menu-filters">
        <div class="select-menu-text-filter">
          <input type="text" aria-label="Filter branches/tags" id="context-commitish-filter-field" class="js-filterable-field js-navigation-enable" placeholder="Filter branches/tags">
        </div>
        <div class="select-menu-tabs">
          <ul>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="branches" class="js-select-menu-tab">Branches</a>
            </li>
            <li class="select-menu-tab">
              <a href="#" data-tab-filter="tags" class="js-select-menu-tab">Tags</a>
            </li>
          </ul>
        </div><!-- /.select-menu-tabs -->
      </div><!-- /.select-menu-filters -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="branches">

        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/geekq/workflow/tree/fork_queue"
                 data-name="fork_queue"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="fork_queue">fork_queue</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item selected">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/geekq/workflow/tree/master"
                 data-name="master"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="master">master</a>
            </div> <!-- /.select-menu-item -->
        </div>

          <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

      <div class="select-menu-list select-menu-tab-bucket js-select-menu-tab-bucket" data-tab-filter="tags">
        <div data-filterable-for="context-commitish-filter-field" data-filterable-type="substring">


            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/geekq/workflow/tree/v1.0.0"
                 data-name="v1.0.0"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="v1.0.0">v1.0.0</a>
            </div> <!-- /.select-menu-item -->
            <div class="select-menu-item js-navigation-item ">
              <span class="select-menu-item-icon octicon octicon-check"></span>
              <a href="/geekq/workflow/tree/v0.8.7"
                 data-name="v0.8.7"
                 data-skip-pjax="true"
                 rel="nofollow"
                 class="js-navigation-open select-menu-item-text js-select-button-text css-truncate-target"
                 title="v0.8.7">v0.8.7</a>
            </div> <!-- /.select-menu-item -->
        </div>

        <div class="select-menu-no-results">Nothing to show</div>
      </div> <!-- /.select-menu-list -->

    </div> <!-- /.select-menu-modal -->
  </div> <!-- /.select-menu-modal-holder -->
</div> <!-- /.select-menu -->


  <div class="breadcrumb"><span class='repo-root js-repo-root'><span itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/geekq/workflow" data-branch="master" data-direction="back" data-pjax="true" itemscope="url"><span itemprop="title">workflow</span></a></span></span><span class="separator"> / </span><form action="/login?return_to=%2Fgeekq%2Fworkflow" aria-label="Sign in to make or propose changes" class="js-new-blob-form tooltipped tooltipped-e new-file-link" method="post"><span aria-label="Sign in to make or propose changes" class="js-new-blob-submit octicon octicon-file-add" data-test-id="create-new-git-file" role="button"></span></form></div>
</div>



<a href="/geekq/workflow/find/master"
  data-hotkey="t" class="js-show-file-finder" style="display:none" data-pjax>Show File Finder</a>
<div class="bubble files-bubble">
    <div class="branch-infobar clearfix">
      <p>
          This branch is
          0 commits ahead and
          0 commits behind master
      </p>

      <ul class="lightweight-actions">
        <li>
            <a href="/geekq/workflow/pull/new/master">
              <span class="octicon octicon-git-pull-request"></span>
              Pull Request
            </a>
        </li>
        <!--
        <li>
          <a href="#">
            <span class="octicon octicon-comment-discussion"></span>
            Branch discussion
          </a>
        </li>
        -->
        <li>
          <a href="/geekq/workflow/compare">
            <span class="octicon octicon-diff"></span>
            Compare
          </a>
        </li>
      </ul>

    </div>

  
  <div class="commit commit-tease js-details-container" >
    <p class="commit-title ">
        <a href="/geekq/workflow/commit/ba758ec619807293ab7e3c4e16964e52efd1bf85" class="message" data-pjax="true" title="Update README">Update README</a>
        
    </p>
    <div class="commit-meta">
      <span aria-label="Copy SHA" class="js-zeroclipboard zeroclipboard-link" data-clipboard-text="ba758ec619807293ab7e3c4e16964e52efd1bf85" data-copied-hint="copied!"><span class="octicon octicon-clippy"></span></span>
      <a href="/geekq/workflow/commit/ba758ec619807293ab7e3c4e16964e52efd1bf85" class="sha-block" data-pjax>latest commit <span class="sha">ba758ec619</span></a>

      <div class="authorship">
        <img alt="Vladimir Dobriakov" class="gravatar js-avatar" data-user="25747" height="20" src="https://avatars1.githubusercontent.com/u/25747?s=140" width="20" />
        <span class="author-name"><a href="/geekq" data-skip-pjax="true" rel="author">geekq</a></span>
        authored <time class="js-relative-date updated" data-title-format="YYYY-MM-DD HH:mm:ss" datetime="2014-02-14T09:28:29+01:00" title="2014-02-14 16:28:29">February 14, 2014</time>

      </div>
    </div>
  </div>

  <table class="files" data-pjax>

    
<tbody class=""
  data-url="/geekq/workflow/file-list/master">
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-directory"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/tree/master/gemfiles" class="js-directory-link" id="ac46a8b5a40536c4171a5ebee5aca2d4-91b1622cac394084f74cfc2a834ef874df76fd4c" title="gemfiles">gemfiles</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/e36359f600fa82eacf8e1ab7ac31144ca4d0e403" class="message" data-pjax="true" title="Fix tests for Rails 4

* require `protected_attributes` gem for Rails 4
* fix `Comparable` implementation
* silence warnings">Fix tests for Rails 4</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2013-08-03T12:54:26+06:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2013-08-03 12:54:26 +0600">August 03, 2013</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-directory"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/tree/master/lib" class="js-directory-link" id="e8acc63b1e238f3255c900eed37254b8-c4ba3dc52244134a91fa59167b43e8fe7db484d5" title="lib">lib</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/bcbc60cff3aec6dd403b0f149f236090f12562da" class="message" data-pjax="true" title="Fix #98 on_STATE_entry and on_STATE_exit protected callbacks for Ruby 2.0 and newer">Fix</a> <a href="https://github.com/geekq/workflow/issues/98" class="issue-link" title="Ruby 2.1 support?">#98</a> <a href="/geekq/workflow/commit/bcbc60cff3aec6dd403b0f149f236090f12562da" class="message" data-pjax="true" title="Fix #98 on_STATE_entry and on_STATE_exit protected callbacks for Ruby 2.0 and newer">on_STATE_entry and on_STATE_exit protected callbacks for Rubyâ¦</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2014-02-14T09:13:33+01:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2014-02-14 09:13:33 +0100">February 14, 2014</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-directory"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/tree/master/test" class="js-directory-link" id="098f6bcd4621d373cade4e832627b4f6-9b1f830181a04a221f445031338cc355ff288e4b" title="test">test</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/81c04778615ee4881d816f8364b20deab803e0c8" class="message" data-pjax="true" title="Add test for protected on_***state***_entry, should fail on some Ruby versions">Add test for protected on_***state***_entry, should fail on some Rubyâ¦</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2014-02-14T09:04:16+01:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2014-02-14 09:04:16 +0100">February 14, 2014</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/.gitignore" class="js-directory-link" id="a084b794bc0759e7a6b77810e01874f2-5c3dd6534783ca458df1e2d3f7f6ebf927068bb2" title=".gitignore">.gitignore</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/533b0d630944da899d134b9d0f90d3fda41efc44" class="message" data-pjax="true" title="Switch from jeweler to pure bundler for building gem">Switch from jeweler to pure bundler for building gem</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2013-01-14T17:07:50+01:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2013-01-14 17:07:50 +0100">January 14, 2013</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/.travis.yml" class="js-directory-link" id="354f30a63fb0907d4ad57269548329e3-98122e754500683ca8484932a6784c39b29286b5" title=".travis.yml">.travis.yml</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/c0bff528bed3af0a89164bbfbd60adb50903ac4c" class="message" data-pjax="true" title="Add travis CI configuration for Ruby 2.1">Add travis CI configuration for Ruby 2.1</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2014-02-14T08:46:04+01:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2014-02-14 08:46:04 +0100">February 14, 2014</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/Gemfile" class="js-directory-link" id="8b7db4d5cc4b8f6dc8feb7030baa2478-c80ee3697054566d1a4247d80be78ec3ddfde295" title="Gemfile">Gemfile</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/1a27f75cee8bf91af5c1ee795b660c9adfbdc347" class="message" data-pjax="true" title="Big reorganization

Separate functionality to separate files">Big reorganization</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2013-01-30T10:37:24-05:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2013-01-30 10:37:24 -0500">January 30, 2013</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/MIT-LICENSE" class="js-directory-link" id="6d6f69ab160d70085563c5d6eb87b978-bd6775236ea0b2c33c263745b5776905aea7573a" title="MIT-LICENSE">MIT-LICENSE</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/a826f8da6453e9e9c9990d36e8d9e698dbe37501" class="message" data-pjax="true" title="renamed the file so it is clear, that the license is the MIT license">renamed the file so it is clear, that the license is the MIT license</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2009-06-10T09:32:41+02:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2009-06-10 09:32:41 +0200">June 10, 2009</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/README.markdown" class="js-directory-link" id="0a369498a5a8db3ac8fa606b544c9810-c3d964aa993b72d51346686240d9b6ce4e7b9d28" title="README.markdown">README.markdown</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/ba758ec619807293ab7e3c4e16964e52efd1bf85" class="message" data-pjax="true" title="Update README">Update README</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2014-02-14T09:28:29+01:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2014-02-14 09:28:29 +0100">February 14, 2014</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/Rakefile" class="js-directory-link" id="52c976fc38ed2b4e3b1192f8a8e24cff-3d54bb386b66ff2f447341c5fab799c12eb8700b" title="Rakefile">Rakefile</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/d6215b39c1d5b4566a424f76de06ab7c08f409fe" class="message" data-pjax="true" title="make graphviz/active_support optional in case you dont want nice graphs">make graphviz/active_support optional in case you dont want nice graphs</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2013-03-01T16:14:13-05:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2013-03-01 16:14:13 -0500">March 01, 2013</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/orders_workflow.png" class="js-directory-link" id="d77eb82e9a1a2f4eafcb233aee71c043-a10ae05c7ee3f3c457530f39e0ffdaeb8f6f4085" title="orders_workflow.png">orders_workflow.png</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/1a27f75cee8bf91af5c1ee795b660c9adfbdc347" class="message" data-pjax="true" title="Big reorganization

Separate functionality to separate files">Big reorganization</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2013-01-30T10:37:24-05:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2013-01-30 10:37:24 -0500">January 30, 2013</local-time></span></td>
    </tr>
    <tr>
      <td class="icon">
        <span class="octicon octicon-file-text"></span>
        <img alt="Octocat-spinner-32" class="spinner" height="16" src="https://github.global.ssl.fastly.net/images/spinners/octocat-spinner-32.gif" width="16" />
      </td>
      <td class="content">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/blob/master/workflow.gemspec" class="js-directory-link" id="770cb00b302573fb0befa0f3ee3e7120-9c5a6e491794baf9e5a4dd9212f96fb763b1f61d" title="workflow.gemspec">workflow.gemspec</a></span>
      </td>
      <td class="message">
        <span class="css-truncate css-truncate-target"><a href="/geekq/workflow/commit/d6215b39c1d5b4566a424f76de06ab7c08f409fe" class="message" data-pjax="true" title="make graphviz/active_support optional in case you dont want nice graphs">make graphviz/active_support optional in case you dont want nice graphs</a></span>
      </td>
      <td class="age"><span class="css-truncate css-truncate-target"><local-time datetime="2013-03-01T16:14:13-05:00" from="now" title-format="%Y-%m-%d %H:%M:%S %z" title="2013-03-01 16:14:13 -0500">March 01, 2013</local-time></span></td>
    </tr>
</tbody>

  </table>
</div>

  <div id="readme" class="clearfix announce instapaper_body markdown">
    <span class="name">
      <span class="octicon octicon-book"></span>
      README.markdown
    </span>

    <article class="markdown-body entry-content" itemprop="mainContentOfPage"><p><a href="https://travis-ci.org/geekq/workflow"><img src="https://github-camo.global.ssl.fastly.net/4568e6960e2cbaa786ad2325e614a0c4f7ced5fb/68747470733a2f2f7472617669732d63692e6f72672f6765656b712f776f726b666c6f772e706e673f6272616e63683d6d6173746572" alt="Build Status" data-canonical-src="https://travis-ci.org/geekq/workflow.png?branch=master" style="max-width:100%;"></a></p>

<h2>
<a name="what-is-workflow" class="anchor" href="#what-is-workflow"><span class="octicon octicon-link"></span></a>What is workflow?</h2>

<p>Workflow is a finite-state-machine-inspired API for modeling and
interacting with what we tend to refer to as 'workflow'.</p>

<p>A lot of business modeling tends to involve workflow-like concepts, and
the aim of this library is to make the expression of these concepts as
clear as possible, using similar terminology as found in state machine
theory.</p>

<p>So, a workflow has a state. It can only be in one state at a time. When
a workflow changes state, we call that a transition. Transitions occur
on an event, so events cause transitions to occur. Additionally, when an
event fires, other arbitrary code can be executed, we call those actions.
So any given state has a bunch of events, any event in a state causes a
transition to another state and potentially causes code to be executed
(an action). We can hook into states when they are entered, and exited
from, and we can cause transitions to fail (guards), and we can hook in
to every transition that occurs ever for whatever reason we can come up
with.</p>

<p>Now, all that's a mouthful, but we'll demonstrate the API bit by bit
with a real-ish world example.</p>

<p>Let's say we're modeling article submission from journalists. An article
is written, then submitted. When it's submitted, it's awaiting review.
Someone reviews the article, and then either accepts or rejects it.
Here is the expression of this workflow using the API:</p>

<pre><code>class Article
  include Workflow
  workflow do
    state :new do
      event :submit, :transitions_to =&gt; :awaiting_review
    end
    state :awaiting_review do
      event :review, :transitions_to =&gt; :being_reviewed
    end
    state :being_reviewed do
      event :accept, :transitions_to =&gt; :accepted
      event :reject, :transitions_to =&gt; :rejected
    end
    state :accepted
    state :rejected
  end
end
</code></pre>

<p>Nice, isn't it!</p>

<p>Note: the first state in the definition (<code>:new</code> in the example, but you
can name it as you wish) is used as the initial state - newly created
objects start their life cycle in that state.</p>

<p>Let's create an article instance and check in which state it is:</p>

<pre><code>article = Article.new
article.accepted? # =&gt; false
article.new? # =&gt; true
</code></pre>

<p>You can also access the whole <code>current_state</code> object including the list
of possible events and other meta information:</p>

<pre><code>article.current_state
=&gt; #&lt;Workflow::State:0x7f1e3d6731f0 @events={
  :submit=&gt;#&lt;Workflow::Event:0x7f1e3d6730d8 @action=nil,
    @transitions_to=:awaiting_review, @name=:submit, @meta={}&gt;},
  name:new, meta{}
</code></pre>

<p>On Ruby 1.9 and above, you can check whether a state comes before or
after another state (by the order they were defined):</p>

<pre><code>article.current_state
=&gt; being_reviewed
article.current_state &lt; :accepted
=&gt; true
article.current_state &gt;= :accepted
=&gt; false
article.between? :awaiting_review, :rejected
=&gt; true
</code></pre>

<p>Now we can call the submit event, which transitions to the
<tt>:awaiting_review</tt> state:</p>

<pre><code>article.submit!
article.awaiting_review? # =&gt; true
</code></pre>

<p>Events are actually instance methods on a workflow, and depending on the
state you're in, you'll have a different set of events used to
transition to other states.</p>

<p>It is also easy to check, if a certain transition is possible from the
current state . <code>article.can_submit?</code> checks if there is a <code>:submit</code>
event (transition) defined for the current state.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<pre><code>gem install workflow
</code></pre>

<p><strong>Important</strong>: If you're interested in graphing your workflow state machine, you will also need to
install the <code>active_support</code> and <code>ruby-graphviz</code> gems.</p>

<p>Versions up to and including 1.0.0 are also available as a single file download -
<a href="https://github.com/geekq/workflow/blob/v1.0.0/lib/workflow.rb">lib/workflow.rb file</a>.</p>

<h2>
<a name="ruby-19" class="anchor" href="#ruby-19"><span class="octicon octicon-link"></span></a>Ruby 1.9</h2>

<p>Workflow gem does not work with some Ruby 1.9
builds due to a known bug in Ruby 1.9. Either</p>

<ul>
<li>use newer ruby build, 1.9.2-p136 and -p180 tested to work</li>
<li>or compile your Ruby 1.9 from source</li>
<li>or <a href="http://github.com/geekq/workflow/issues#issue/6">comment out some lines in workflow</a>
(reduces functionality).</li>
</ul><h2>
<a name="examples" class="anchor" href="#examples"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>After installation or downloading of the library you can easily try out
all the example code from this README in irb.</p>

<pre><code>$ irb
require 'rubygems'
require 'workflow'
</code></pre>

<p>Now just copy and paste the source code from the beginning of this README
file snippet by snippet and observe the output.</p>

<h2>
<a name="transition-event-handler" class="anchor" href="#transition-event-handler"><span class="octicon octicon-link"></span></a>Transition event handler</h2>

<p>The best way is to use convention over configuration and to define a
method with the same name as the event. Then it is automatically invoked
when event is raised. For the Article workflow defined earlier it would
be:</p>

<pre><code>class Article
  def reject
    puts 'sending email to the author explaining the reason...'
  end
end
</code></pre>

<p><code>article.review!; article.reject!</code> will cause a state transition, persist the new state
(if integrated with ActiveRecord) and invoke this user defined reject
method.</p>

<p>Note: on successful transition from one state to another the workflow
gem immediately persists the new workflow state with <code>update_column()</code>,
bypassing any ActiveRecord callbacks including <code>updated_at</code> update.
This way it is possible to deal with the validation and to save the
pending changes to a record at some later point instead of the moment
when transition occurs.</p>

<p>You can also define event handler accepting/requiring additional
arguments:</p>

<pre><code>class Article
  def review(reviewer = '')
    puts "[#{reviewer}] is now reviewing the article"
  end
end

article2 = Article.new
article2.submit!
article2.review!('Homer Simpson') # =&gt; [Homer Simpson] is now reviewing the article
</code></pre>

<h3>
<a name="the-old-deprecated-way" class="anchor" href="#the-old-deprecated-way"><span class="octicon octicon-link"></span></a>The old, deprecated way</h3>

<p>The old way, using a block is still supported but deprecated:</p>

<pre><code>event :review, :transitions_to =&gt; :being_reviewed do |reviewer|
  # store the reviewer
end
</code></pre>

<p>We've noticed, that mixing the list of events and states with the blocks
invoked for particular transitions leads to a bumpy and poorly readable code
due to a deep nesting. We tried (and dismissed) lambdas for this. Eventually
we decided to invoke an optional user defined callback method with the same
name as the event (convention over configuration) as explained before.</p>

<h2>
<a name="integration-with-activerecord" class="anchor" href="#integration-with-activerecord"><span class="octicon octicon-link"></span></a>Integration with ActiveRecord</h2>

<p>Workflow library can handle the state persistence fully automatically. You
only need to define a string field on the table called <code>workflow_state</code>
and include the workflow mixin in your model class as usual:</p>

<pre><code>class Order &lt; ActiveRecord::Base
  include Workflow
  workflow do
    # list states and transitions here
  end
end
</code></pre>

<p>On a database record loading all the state check methods e.g.
<code>article.state</code>, <code>article.awaiting_review?</code> are immediately available.
For new records or if the <code>workflow_state</code> field is not set the state
defaults to the first state declared in the workflow specification. In
our example it is <code>:new</code>, so <code>Article.new.new?</code> returns true and
<code>Article.new.approved?</code> returns false.</p>

<p>At the end of a successful state transition like <code>article.approve!</code> the
new state is immediately saved in the database.</p>

<p>You can change this behaviour by overriding <code>persist_workflow_state</code>
method.</p>

<h3>
<a name="scopes" class="anchor" href="#scopes"><span class="octicon octicon-link"></span></a>Scopes</h3>

<p>Workflow library also adds automatically generated scopes with names based on
states names:</p>

<pre><code>class Order &lt; ActiveRecord::Base
  include Workflow
  workflow do
    state :approved
    state :pending
  end
end

# returns all orders with `approved` state
Order.with_approved_state

# returns all orders with `pending` state
Order.with_pending_state
</code></pre>

<h3>
<a name="custom-workflow-database-column" class="anchor" href="#custom-workflow-database-column"><span class="octicon octicon-link"></span></a>Custom workflow database column</h3>

<p><a href="http://imeuble.info/">meuble</a> contributed a solution for using
custom persistence column easily, e.g. for a legacy database schema:</p>

<pre><code>class LegacyOrder &lt; ActiveRecord::Base
  include Workflow

  workflow_column :foo_bar # use this legacy database column for
                           # persistence
end
</code></pre>

<h3>
<a name="single-table-inheritance" class="anchor" href="#single-table-inheritance"><span class="octicon octicon-link"></span></a>Single table inheritance</h3>

<p>Single table inheritance is also supported. Descendant classes can either
inherit the workflow definition from the parent or override with its own
definition.</p>

<h2>
<a name="custom-workflow-state-persistence" class="anchor" href="#custom-workflow-state-persistence"><span class="octicon octicon-link"></span></a>Custom workflow state persistence</h2>

<p>If you do not use a relational database and ActiveRecord, you can still
integrate the workflow very easily. To implement persistence you just
need to override <code>load_workflow_state</code> and
<code>persist_workflow_state(new_value)</code> methods. Next section contains an example for
using CouchDB, a document oriented database.</p>

<p><a href="http://tim.lossen.de/">Tim Lossen</a> implemented support
for <a href="http://github.com/tlossen/remodel">remodel</a> / <a href="http://github.com/antirez/redis">redis</a>
key-value store.</p>

<h2>
<a name="integration-with-couchdb" class="anchor" href="#integration-with-couchdb"><span class="octicon octicon-link"></span></a>Integration with CouchDB</h2>

<p>We are using the compact <a href="http://github.com/geekq/couchtiny">couchtiny library</a>
here. But the implementation would look similar for the popular
couchrest library.</p>

<pre><code>require 'couchtiny'
require 'couchtiny/document'
require 'workflow'

class User &lt; CouchTiny::Document
  include Workflow
  workflow do
    state :submitted do
      event :activate_via_link, :transitions_to =&gt; :proved_email
    end
    state :proved_email
  end

  def load_workflow_state
    self[:workflow_state]
  end

  def persist_workflow_state(new_value)
    self[:workflow_state] = new_value
    save!
  end
end
</code></pre>

<p>Please also have a look at
<a href="http://github.com/geekq/workflow/blob/master/test/couchtiny_example.rb">the full source code</a>.</p>

<h2>
<a name="integration-with-mongoid" class="anchor" href="#integration-with-mongoid"><span class="octicon octicon-link"></span></a>Integration with Mongoid</h2>

<p>You can integrate with Mongoid following the example above for CouchDB, but there is a gem that does that for you (and includes extensive tests):
<a href="http://github.com/bowsersenior/workflow_on_mongoid">workflow_on_mongoid</a></p>

<h2>
<a name="accessing-your-workflow-specification" class="anchor" href="#accessing-your-workflow-specification"><span class="octicon octicon-link"></span></a>Accessing your workflow specification</h2>

<p>You can easily reflect on workflow specification programmatically - for
the whole class or for the current object. Examples:</p>

<pre><code>article2.current_state.events # lists possible events from here
article2.current_state.events[:reject].transitions_to # =&gt; :rejected

Article.workflow_spec.states.keys
#=&gt; [:rejected, :awaiting_review, :being_reviewed, :accepted, :new]

Article.workflow_spec.state_names
#=&gt; [:rejected, :awaiting_review, :being_reviewed, :accepted, :new]

# list all events for all states
Article.workflow_spec.states.values.collect &amp;:events
</code></pre>

<p>You can also store and later retrieve additional meta data for every
state and every event:</p>

<pre><code>class MyProcess
  include Workflow
  workflow do
    state :main, :meta =&gt; {:importance =&gt; 8}
    state :supplemental, :meta =&gt; {:importance =&gt; 1}
  end
end
puts MyProcess.workflow_spec.states[:supplemental].meta[:importance] # =&gt; 1
</code></pre>

<p>The workflow library itself uses this feature to tweak the graphical
representation of the workflow. See below.</p>

<h2>
<a name="advanced-transition-hooks" class="anchor" href="#advanced-transition-hooks"><span class="octicon octicon-link"></span></a>Advanced transition hooks</h2>

<h3>
<a name="on_entryon_exit" class="anchor" href="#on_entryon_exit"><span class="octicon octicon-link"></span></a>on_entry/on_exit</h3>

<p>We already had a look at the declaring callbacks for particular workflow
events. If you would like to react to all transitions to/from the same state
in the same way you can use the on_entry/on_exit hooks. You can either define it
with a block inside the workflow definition or through naming
convention, e.g. for the state :pending just define the method
<code>on_pending_exit(new_state, event, *args)</code> somewhere in your class.</p>

<h3>
<a name="on_transition" class="anchor" href="#on_transition"><span class="octicon octicon-link"></span></a>on_transition</h3>

<p>If you want to be informed about everything happening everywhere, e.g. for
logging then you can use the universal <code>on_transition</code> hook:</p>

<pre><code>workflow do
  state :one do
    event :increment, :transitions_to =&gt; :two
  end
  state :two
  on_transition do |from, to, triggering_event, *event_args|
    Log.info "#{from} -&gt; #{to}"
  end
end
</code></pre>

<p>Please also have a look at the <a href="http://github.com/geekq/workflow/blob/master/test/advanced_hooks_and_validation_test.rb">advanced end to end
example</a>.</p>

<h3>
<a name="on_error" class="anchor" href="#on_error"><span class="octicon octicon-link"></span></a>on_error</h3>

<p>If you want to do custom exception handling internal to workflow, you can define an <code>on_error</code> hook in your workflow.
For example:</p>

<pre><code>workflow do
  state :first do
    event :forward, :transitions_to =&gt; :second
  end
  state :second

  on_error do |error, from, to, event, *args|
    Log.info "Exception(#error.class) on #{from} -&gt; #{to}"
  end
end
</code></pre>

<p>If forward! results in an exception, <code>on_error</code> is invoked and the workflow stays in a 'first' state.  This capability
is particularly useful if your errors are transient and you want to queue up a job to retry in the future without
affecting the existing workflow state.</p>

<h3>
<a name="guards" class="anchor" href="#guards"><span class="octicon octicon-link"></span></a>Guards</h3>

<p>If you want to halt the transition conditionally, you can just raise an
exception in your <a href="#transition_event_handler">transition event handler</a>.
There is a helper called <code>halt!</code>, which raises the
Workflow::TransitionHalted exception. You can provide an additional
<code>halted_because</code> parameter.</p>

<pre><code>def reject(reason)
  halt! 'We do not reject articles unless the reason is important' \
    unless reason =~ /important/i
end
</code></pre>

<p>The traditional <code>halt</code> (without the exclamation mark) is still supported
too. This just prevents the state change without raising an
exception.</p>

<p>You can check <code>halted?</code> and <code>halted_because</code> values later.</p>

<h3>
<a name="hook-order" class="anchor" href="#hook-order"><span class="octicon octicon-link"></span></a>Hook order</h3>

<p>The whole event sequence is as follows:</p>

<pre><code>* before_transition
* event specific action
* on_transition (if action did not halt)
* on_exit
* PERSIST WORKFLOW STATE, i.e. transition
* on_entry
* after_transition
</code></pre>

<h2>
<a name="multiple-workflows" class="anchor" href="#multiple-workflows"><span class="octicon octicon-link"></span></a>Multiple Workflows</h2>

<p>I am frequently asked if it's possible to represent multiple "workflows"
in an ActiveRecord class.</p>

<p>The solution depends on your business logic and how you want to
structure your implementation.</p>

<h3>
<a name="use-single-table-inheritance" class="anchor" href="#use-single-table-inheritance"><span class="octicon octicon-link"></span></a>Use Single Table Inheritance</h3>

<p>One solution can be to do it on the class level and use a class
hierarchy. You can use <a href="http://www.martinfowler.com/eaaCatalog/singleTableInheritance.html">single table inheritance</a> so there is only
single <code>orders</code> table in the database. Read more in the chapter "Single
Table Inheritance" of the <a href="http://api.rubyonrails.org/classes/ActiveRecord/Base.html">ActiveRecord documentation</a>.
Then you define your different classes:</p>

<pre><code>class Order &lt; ActiveRecord::Base
  include Workflow
end

class SmallOrder &lt; Order
  workflow do
    # workflow definition for small orders goes here
  end
end

class BigOrder &lt; Order
  workflow do
    # workflow for big orders, probably with a longer approval chain
  end
end
</code></pre>

<h3>
<a name="individual-workflows-for-objects" class="anchor" href="#individual-workflows-for-objects"><span class="octicon octicon-link"></span></a>Individual workflows for objects</h3>

<p>Another solution would be to connect different workflows to object
instances via metaclass, e.g.</p>

<pre><code># Load an object from the database
booking = Booking.find(1234)

# Now define a workflow - exclusively for this object,
# probably depending on some condition or database field
if # some condition
  class &lt;&lt; booking
    include Workflow
    workflow do
      state :state1
      state :state2
    end
  end
# if some other condition, use a different workflow
</code></pre>

<p>You can also encapsulate this in a class method or even put in some
ActiveRecord callback. Please also have a look at <a href="http://github.com/geekq/workflow/blob/master/test/multiple_workflows_test.rb">the full working
example</a>!</p>

<h2>
<a name="documenting-with-diagrams" class="anchor" href="#documenting-with-diagrams"><span class="octicon octicon-link"></span></a>Documenting with diagrams</h2>

<p>You can generate a graphical representation of the workflow for
a particular class for documentation purposes.
Use <code>Workflow::create_workflow_diagram(class)</code> in your rake task like:</p>

<pre><code>namespace :doc do
  desc "Generate a workflow graph for a model passed e.g. as 'MODEL=Order'."
  task :workflow =&gt; :environment do
    require 'workflow/draw'
    Workflow::Draw::workflow_diagram(ENV['MODEL'].constantize)
  end
end
</code></pre>

<h2>
<a name="earlier-versions" class="anchor" href="#earlier-versions"><span class="octicon octicon-link"></span></a>Earlier versions</h2>

<p>The <code>workflow</code> library was originally written by Ryan Allen.</p>

<p>The version 0.3 was almost completely (including ActiveRecord
integration, API for accessing workflow specification,
method_missing free implementation) rewritten by Vladimir Dobriakov
keeping the original workflow DSL spirit.</p>

<h2>
<a name="migration-from-the-original-ryans-library" class="anchor" href="#migration-from-the-original-ryans-library"><span class="octicon octicon-link"></span></a>Migration from the original Ryan's library</h2>

<p>Credit: Michael (rockrep)</p>

<p>Accessing workflow specification</p>

<pre><code>my_instance.workflow # old
MyClass.workflow_spec # new
</code></pre>

<p>Accessing states, events, meta, e.g.</p>

<pre><code>my_instance.workflow.states(:some_state).events(:some_event).meta[:some_meta_tag] # old
MyClass.workflow_spec.states[:some_state].events[:some_event].meta[:some_meta_tag] # new
</code></pre>

<p>Causing state transitions</p>

<pre><code>my_instance.workflow.my_event # old
my_instance.my_event! # new
</code></pre>

<p>when using both a block and a callback method for an event, the block executes prior to the callback</p>

<h2>
<a name="changelog" class="anchor" href="#changelog"><span class="octicon octicon-link"></span></a>Changelog</h2>

<h3>
<a name="new-in-the-version-120" class="anchor" href="#new-in-the-version-120"><span class="octicon octicon-link"></span></a>New in the version 1.2.0</h3>

<ul>
<li>Fix issue #98 protected on_* callbacks in Ruby 2</li>
</ul><h3>
<a name="new-in-the-version-110" class="anchor" href="#new-in-the-version-110"><span class="octicon octicon-link"></span></a>New in the version 1.1.0</h3>

<ul>
<li>Tested with ActiveRecord 4.0 (Rails 4.0)</li>
<li>Tested with Ruby 2.0</li>
<li>automatically generated scopes with names based on state names</li>
<li>clean workflow definition override for class inheritance - undefining
the old convinience methods, s. <a href="http://git.io/FZO02A">http://git.io/FZO02A</a>
</li>
</ul><h3>
<a name="new-in-the-version-100" class="anchor" href="#new-in-the-version-100"><span class="octicon octicon-link"></span></a>New in the version 1.0.0</h3>

<ul>
<li>
<p><strong>Support to private/protected callback methods.</strong>
See also issues <a href="https://github.com/geekq/workflow/pull/53">#53</a>
and <a href="https://github.com/geekq/workflow/pull/58">#58</a>. With the new
implementation:</p>

<ul>
<li>callback methods can be hidden (non public): both private methods
in the immediate class and protected methods somewhere in the class
hierarchy are supported</li>
<li>no unintentional calls on <code>fail!</code> and other Kernel methods</li>
<li>inheritance hierarchy with workflow is supported</li>
</ul>
</li>
<li><p>using Rails' 3.1 <code>update_column</code> whenever available so only the
workflow state column and not other pending attribute changes are
saved on state transition. Fallback to <code>update_attribute</code> for older
Rails and other ORMs. <a href="https://github.com/geekq/workflow/commit/7e091d8ded1aeeb0a86647bbf7d78ab3c9d0c458">commit</a></p></li>
</ul><h3>
<a name="new-in-the-version-087" class="anchor" href="#new-in-the-version-087"><span class="octicon octicon-link"></span></a>New in the version 0.8.7</h3>

<ul>
<li>switch from <a href="http://github.com/technicalpickles/jeweler">jeweler</a> to pure bundler for building gems</li>
</ul><h3>
<a name="new-in-the-version-080" class="anchor" href="#new-in-the-version-080"><span class="octicon octicon-link"></span></a>New in the version 0.8.0</h3>

<ul>
<li>check if a certain transition possible from the current state with
<code>can_....?</code>
</li>
<li>fix workflow_state persistence for multiple_workflows example</li>
<li>add before_transition and after_transition hooks as suggested by
<a href="https://github.com/kasperbn">kasperbn</a>
</li>
</ul><h3>
<a name="new-in-the-version-070" class="anchor" href="#new-in-the-version-070"><span class="octicon octicon-link"></span></a>New in the version 0.7.0</h3>

<ul>
<li>fix issue#10 Workflow::create_workflow_diagram documentation and path
escaping</li>
<li>fix issue#7 workflow_column does not work STI (single table
inheritance) ActiveRecord models</li>
<li>fix issue#5 Diagram generation fails for models in modules</li>
</ul><h3>
<a name="new-in-the-version-060" class="anchor" href="#new-in-the-version-060"><span class="octicon octicon-link"></span></a>New in the version 0.6.0</h3>

<ul>
<li>enable multiple workflows by connecting workflow to object instances
(using metaclass) instead of connecting to a class, s. "Multiple
Workflows" section</li>
</ul><h3>
<a name="new-in-the-version-050" class="anchor" href="#new-in-the-version-050"><span class="octicon octicon-link"></span></a>New in the version 0.5.0</h3>

<ul>
<li>fix issue#3 change the behaviour of halt! to immediately raise an
exception. See also <a href="http://github.com/geekq/workflow/issues/#issue/3">http://github.com/geekq/workflow/issues/#issue/3</a>
</li>
</ul><h3>
<a name="new-in-the-version-040" class="anchor" href="#new-in-the-version-040"><span class="octicon octicon-link"></span></a>New in the version 0.4.0</h3>

<ul>
<li>completely rewritten the documentation to match my branch</li>
<li>switch to <a href="http://github.com/technicalpickles/jeweler">jeweler</a> for building gems</li>
<li>use <a href="http://gemcutter.org/gems/workflow">gemcutter</a> for gem distribution</li>
<li>every described feature is backed up by an automated test</li>
</ul><h3>
<a name="new-in-the-version-030" class="anchor" href="#new-in-the-version-030"><span class="octicon octicon-link"></span></a>New in the version 0.3.0</h3>

<p>Intermixing of transition graph definition (states, transitions)
on the one side and implementation of the actions on the other side
for a bigger state machine can introduce clutter.</p>

<p>To reduce this clutter it is now possible to use state entry- and
exit- hooks defined through a naming convention. For example, if there
is a state :pending, then instead of using a
block:</p>

<pre><code>state :pending do
  on_entry do
    # your implementation here
  end
end
</code></pre>

<p>you can hook in by defining method</p>

<pre><code>def on_pending_exit(new_state, event, *args)
  # your implementation here
end
</code></pre>

<p>anywhere in your class. You can also use a simpler function signature
like <code>def on_pending_exit(*args)</code> if your are not interested in
arguments.  Please note: <code>def on_pending_exit()</code> with an empty list
would not work.</p>

<p>If both a function with a name according to naming convention and the
on_entry/on_exit block are given, then only on_entry/on_exit block is used.</p>

<h2>
<a name="support" class="anchor" href="#support"><span class="octicon octicon-link"></span></a>Support</h2>

<h3>
<a name="reporting-bugs" class="anchor" href="#reporting-bugs"><span class="octicon octicon-link"></span></a>Reporting bugs</h3>

<p><a href="http://github.com/geekq/workflow/issues">http://github.com/geekq/workflow/issues</a></p>

<h2>
<a name="about" class="anchor" href="#about"><span class="octicon octicon-link"></span></a>About</h2>

<p>Author: Vladimir Dobriakov, <a href="http://www.innoq.com/blog/vd">http://www.innoq.com/blog/vd</a>, <a href="http://blog.geekq.net/">http://blog.geekq.net/</a></p>

<p>Copyright (c) 2008-2009 Vodafone</p>

<p>Copyright (c) 2007-2008 Ryan Allen, FlashDen Pty Ltd</p>

<p>Based on the work of Ryan Allen and Scott Barron</p>

<p>Licensed under MIT license, see the MIT-LICENSE file.</p></article>
  </div>


        </div>

      </div><!-- /.repo-container -->
      <div class="modal-backdrop"></div>
    </div><!-- /.container -->
  </div><!-- /.site -->


    </div><!-- /.wrapper -->

      <div class="container">
  <div class="site-footer">
    <ul class="site-footer-links right">
      <li><a href="https://status.github.com/">Status</a></li>
      <li><a href="http://developer.github.com">API</a></li>
      <li><a href="http://training.github.com">Training</a></li>
      <li><a href="http://shop.github.com">Shop</a></li>
      <li><a href="/blog">Blog</a></li>
      <li><a href="/about">About</a></li>

    </ul>

    <a href="/">
      <span class="mega-octicon octicon-mark-github" title="GitHub"></span>
    </a>

    <ul class="site-footer-links">
      <li>&copy; 2014 <span title="0.04927s from github-fe118-cp1-prd.iad.github.net">GitHub</span>, Inc.</li>
        <li><a href="/site/terms">Terms</a></li>
        <li><a href="/site/privacy">Privacy</a></li>
        <li><a href="/security">Security</a></li>
        <li><a href="/contact">Contact</a></li>
    </ul>
  </div><!-- /.site-footer -->
</div><!-- /.container -->


    <div class="fullscreen-overlay js-fullscreen-overlay" id="fullscreen_overlay">
  <div class="fullscreen-container js-fullscreen-container">
    <div class="textarea-wrap">
      <textarea name="fullscreen-contents" id="fullscreen-contents" class="fullscreen-contents js-fullscreen-contents" placeholder="" data-suggester="fullscreen_suggester"></textarea>
    </div>
  </div>
  <div class="fullscreen-sidebar">
    <a href="#" class="exit-fullscreen js-exit-fullscreen tooltipped tooltipped-w" aria-label="Exit Zen Mode">
      <span class="mega-octicon octicon-screen-normal"></span>
    </a>
    <a href="#" class="theme-switcher js-theme-switcher tooltipped tooltipped-w"
      aria-label="Switch themes">
      <span class="octicon octicon-color-mode"></span>
    </a>
  </div>
</div>



    <div id="ajax-error-message" class="flash flash-error">
      <span class="octicon octicon-alert"></span>
      <a href="#" class="octicon octicon-remove-close close js-ajax-error-dismiss"></a>
      Something went wrong with that request. Please try again.
    </div>

  </body>
</html>

